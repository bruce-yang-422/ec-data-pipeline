# 資料日期檢查工具

## 功能說明

`data_date_checker.py` 腳本用於批次檢查 `data_processed/merged` 下所有 CSV 檔案的 `order_date` 欄位，分析日期資料的完整性和連續性，並生成詳細的報表。

## 主要功能

1. **自動掃描檔案**：自動尋找 `data_processed/merged/` 目錄下所有 `*.csv` 檔案
2. **日期格式解析**：支援多種日期格式的解析和驗證
3. **日期範圍分析**：計算每個檔案的起始日期和結束日期
4. **缺失日期檢測**：找出日期範圍內缺失的日期
5. **區間格式顯示**：將連續的缺失日期以區間形式顯示（YYYY-MM-DD~YYYY-MM-DD）
6. **統計報表生成**：生成詳細的 TXT 格式報表

## 支援的日期格式

- `YYYY-MM-DD` (2024-01-01)
- `YYYY/MM/DD` (2024/01/01)
- `YYYY-MM-DD HH:MM:SS` (2024-01-01 12:30:45)
- `YYYY/MM/DD HH:MM:SS` (2024/01/01 12:30:45)
- `YYYY-MM-DD HH:MM` (2024-01-01 12:30)
- `YYYY/MM/DD HH:MM` (2024/01/01 12:30)
- `DD/MM/YYYY` (01/01/2024)
- `MM/DD/YYYY` (01/01/2024)
- `YYYYMMDD` (20240101)

## 輸出報表內容

### 總體統計
- 檢查檔案數
- 包含 `order_date` 欄位的檔案數
- 總資料筆數
- 有效日期筆數
- 無效日期筆數
- 日期有效率

### 各檔案詳細資訊
- 檔案名稱
- 總資料筆數
- 有效/無效日期統計
- 日期範圍（起始日期到結束日期）
- 缺失日期數量和區間列表

### 缺失日期摘要
- 所有檔案的缺失日期彙總
- 去重後的唯一缺失日期區間列表

## 區間格式說明

腳本會自動將連續的缺失日期合併為區間顯示：

- **單日缺失**：`2025-01-15`
- **連續區間**：`2025-01-15~2025-01-20`（表示連續6天缺失）
- **多個區間**：會分別顯示每個連續區間

## 使用方法

```bash
# 在專案根目錄執行
python scripts/data_date_checker.py
```

## 執行結果範例

```
🚀 開始檢查資料日期...
📁 找到 5 個 CSV 檔案：
   - etmall_orders_cleaned.csv
   - momo_accounting_orders_cleaned.csv
   - momo_shipping_orders_cleaned.csv
   - pchome_orders_merged.csv

📖 檢查檔案：etmall_orders_cleaned.csv
📊 總資料筆數：983
✅ 有效日期：983 筆
❌ 無效日期：0 筆
📅 日期範圍：2025-06-01 到 2025-07-30
🔍 缺失日期：59 天
   前5個缺失日期：['2025-06-02', '2025-06-03', '2025-06-04', '2025-06-05', '2025-06-06']

📖 檢查檔案：momo_shipping_orders_cleaned.csv
📊 總資料筆數：7,771
✅ 有效日期：7,771 筆
❌ 無效日期：0 筆
📅 日期範圍：2024-11-28 到 2025-07-31
🔍 缺失日期：7 天
   前5個缺失日期：['2025-07-22', '2025-07-23', '2025-07-24', '2025-07-25', '2025-07-26']

🎉 檢查完成！
📁 檢查檔案數：5
📄 報表位置：temp/date_check_report_20250731_173615.txt
📝 詳細記錄已寫入：logs/data_date_checker.log
```

## 報表範例

```
================================================================================
資料日期檢查報表
================================================================================
生成時間：2025-07-31 17:36:15
檢查檔案數：5

📊 總體統計
----------------------------------------
檢查檔案數：5
包含 order_date 欄位的檔案：5
總資料筆數：12,854
有效日期筆數：12,854
無效日期筆數：0
日期有效率：100.0%

📁 各檔案詳細資訊
================================================================================

檔案名稱：etmall_orders_cleaned.csv
--------------------------------------------------
總資料筆數：983
有效日期：983 筆
無效日期：0 筆
日期範圍：2025-06-01 到 2025-07-30
缺失日期數：59 天
缺失日期列表：
  - 2025-06-02~2025-07-30

檔案名稱：momo_shipping_orders_cleaned.csv
--------------------------------------------------
總資料筆數：7,771
有效日期：7,771 筆
無效日期：0 筆
日期範圍：2024-11-28 到 2025-07-31
缺失日期數：7 天
缺失日期列表：
  - 2025-07-22~2025-07-28

檔案名稱：momo_accounting_orders_cleaned.csv
--------------------------------------------------
總資料筆數：2,625
有效日期：2,625 筆
無效日期：0 筆
日期範圍：2025-05-29 到 2025-07-29
缺失日期數：0 天
✅ 沒有缺失日期

🔍 缺失日期摘要
================================================================================
總共有 59 個不同的缺失日期：
  - 2025-06-02~2025-07-30
```

## 輸出檔案

### 報表檔案
- 位置：`temp/date_check_report_YYYYMMDD_HHMMSS.txt`
- 格式：純文字檔案，包含詳細的檢查結果
- 特色：缺失日期以區間形式顯示，便於快速識別連續缺失的日期

### 日誌檔案
- 位置：`logs/data_date_checker.log`
- 內容：執行時間、檢查檔案數、報表檔案名稱

## 注意事項

1. 確保 `data_processed/merged/` 目錄下有 CSV 檔案
2. 腳本會自動建立 `temp/` 和 `logs/` 目錄（如不存在）
3. 報表檔案名稱包含時間戳，避免覆蓋
4. 連續的缺失日期會自動合併為區間顯示（YYYY-MM-DD~YYYY-MM-DD）
5. 如果區間很多，報表會顯示前後各10個區間
6. 日期解析會嘗試多種格式，提高成功率

## 檔案結構

```
scripts/
├── data_date_checker.py              # 主要腳本
└── README_data_date_checker.md       # 說明文件

data_processed/merged/
├── etmall_orders_cleaned.csv
├── momo_accounting_orders_cleaned.csv
├── momo_shipping_orders_cleaned.csv
├── pchome_orders_merged.csv
└── shopee_orders_cleaned.csv

temp/
└── date_check_report_20250731_173615.txt    # 生成的報表

logs/
└── data_date_checker.log                    # 執行記錄
``` 